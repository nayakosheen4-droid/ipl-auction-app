<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPL Fantasy League</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="fantasy-styles.css">
</head>
<body>
    <div id="fantasyScreen" class="screen">
        <header>
            <div class="header-left">
                <h1>üèÜ IPL Fantasy League</h1>
                <div id="gameweekInfo" class="gameweek-info">Gameweek: -</div>
            </div>
            <div class="header-right">
                <button id="backToAuctionBtn" class="btn btn-secondary">‚Üê Back to Auction</button>
                <button id="fantasyLogoutBtn" class="btn btn-danger">Logout</button>
            </div>
        </header>

        <div class="fantasy-nav">
            <button class="fantasy-nav-btn active" data-view="leaderboard">üèÜ Leaderboard</button>
            <button class="fantasy-nav-btn" data-view="myteam">üë• My Team</button>
            <button class="fantasy-nav-btn" data-view="schedule">üìÖ Schedule</button>
            <button class="fantasy-nav-btn admin-only hidden" data-view="admin">‚öôÔ∏è Admin</button>
        </div>

        <div class="fantasy-content">
            <!-- Leaderboard View -->
            <div id="leaderboardView" class="fantasy-view">
                <div class="view-header">
                    <h2>Gameweek Leaderboard</h2>
                    <select id="gameweekSelector" class="gw-selector">
                        <option value="1">Gameweek 1</option>
                    </select>
                </div>
                
                <div id="leaderboardContent" class="leaderboard-content">
                    <div class="loading-state">Loading leaderboard...</div>
                </div>
            </div>

            <!-- My Team View -->
            <div id="myteamView" class="fantasy-view hidden">
                <div class="view-header">
                    <h2>My Team Performance</h2>
                    <select id="myteamGameweekSelector" class="gw-selector">
                        <option value="1">Gameweek 1</option>
                    </select>
                </div>
                
                <div id="myteamContent" class="myteam-content">
                    <div class="team-total-points">
                        <span class="points-label">Total Points:</span>
                        <span id="myteamTotalPoints" class="points-value">0</span>
                    </div>
                    <div id="myteamPlayers" class="myteam-players"></div>
                </div>
            </div>

            <!-- Schedule View (visible to all ‚Äì load and see match schedule) -->
            <div id="scheduleView" class="fantasy-view hidden">
                <div class="view-header">
                    <h2>Match Schedule</h2>
                </div>
                <div class="schedule-standalone-panel">
                    <div class="admin-schedule-controls">
                        <label for="scheduleSeasonMain" class="schedule-label">Season:</label>
                        <select id="scheduleSeasonMain" class="schedule-season-select">
                            <option value="2025" selected>IPL 2025</option>
                            <option value="2024">IPL 2024</option>
                        </select>
                        <button id="loadScheduleBtnMain" type="button" class="btn btn-admin load-schedule-btn">Load schedule</button>
                    </div>
                    <div id="scheduleListMain" class="schedule-list schedule-list-main">
                        <p class="schedule-placeholder">Click ‚ÄúLoad schedule‚Äù to fetch and show all matches for the selected season.</p>
                    </div>
                </div>
            </div>

            <!-- Admin View -->
            <div id="adminView" class="fantasy-view hidden">
                <div class="view-header">
                    <h2>Admin: Match Results &amp; Leaderboard</h2>
                    <div class="admin-top-actions">
                        <div class="admin-gw-row">
                            <label>Gameweek:</label>
                            <input type="number" id="gwNumber" min="1" value="1" class="admin-gw-input">
                            <select id="gwStatus">
                                <option value="Upcoming">Upcoming</option>
                                <option value="Active">Active</option>
                                <option value="Completed">Completed</option>
                            </select>
                            <button id="setGameweekBtn" class="btn btn-secondary">Set</button>
                        </div>
                        <div class="admin-autostats-row">
                            <span id="autoStatsStatus" class="status-badge status-disabled">Off</span>
                            <span id="apiKeyStatus" class="status-text">API not configured</span>
                            <button id="fetchNowBtn" class="btn btn-secondary btn-sm">Fetch Now</button>
                            <button id="toggleAutoStatsBtn" class="btn btn-secondary btn-sm">Enable</button>
                        </div>
                    </div>
                </div>

                <div class="admin-schedule-layout">
                    <!-- Left: Schedule -->
                    <div class="admin-schedule-panel">
                        <h3>üìÖ Schedule</h3>
                        <div class="admin-schedule-controls">
                            <select id="scheduleSeason">
                                <option value="2025" selected>IPL 2025</option>
                                <option value="2024">IPL 2024</option>
                            </select>
                            <button id="loadScheduleBtn" class="btn btn-admin">Load schedule</button>
                        </div>
                        <div id="scheduleList" class="schedule-list">
                            <p class="schedule-placeholder">Load schedule to see matches. Click a match to view player stats. Use match IDs from Cricbuzz.com URLs when the API returns no scorecard.</p>
                        </div>
                    </div>

                    <!-- Right: Match detail + Add to leaderboard -->
                    <div class="admin-detail-panel">
                        <div id="matchDetailEmpty" class="match-detail-empty">
                            <p>‚Üê Select a match from the schedule to see player stats and add to leaderboard.</p>
                        </div>
                        <div id="matchDetailContent" class="match-detail-content hidden">
                            <h3 id="matchDetailTitle" class="match-detail-title"></h3>
                            <div class="match-detail-tables">
                                <div class="match-detail-section">
                                    <h4>All players (match stats)</h4>
                                    <div id="allPlayersTableWrap" class="table-wrap">
                                        <table class="admin-stats-table" id="allPlayersTable">
                                            <thead><tr><th>Player</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>W</th><th>O</th><th>RC</th><th>C</th></tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="match-detail-section">
                                    <h4>Your league players (fantasy points)</h4>
                                    <div id="leaguePlayersTableWrap" class="table-wrap">
                                        <table class="admin-stats-table" id="leaguePlayersTable">
                                            <thead><tr><th>Player</th><th>Team</th><th>Pos</th><th>R</th><th>W</th><th>C</th><th>Pts</th></tr></thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="add-to-leaderboard-row">
                                <button id="addToLeaderboardBtn" class="btn btn-admin btn-add-leaderboard">
                                    ‚úì Add to leaderboard
                                </button>
                                <span id="addToLeaderboardHint" class="add-hint">Calculates fantasy points for all league players in this match and saves to sheet.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast hidden"></div>
    
    <script src="fantasy.js"></script>
</body>
</html>
